@page "/professionals/{id:int}"
@using WebAthenPs.Models.DTOs.Professional
@using WebAthenPs.Models.DTOs.Professional.ProfessionalTypes.Architect
@using WebAthenPs.Project.Services.Interfaces.Professional
@inject IGenericProfessionalService ProfessionalService

@code {
    [Parameter] public int id { get; set; }

    private GenericProfessionalDTO _professional;
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadProfessionalDetails();
    }

    private async Task LoadProfessionalDetails()
    {
        try
        {
            _professional = await ProfessionalService.GetByIdAsync(id);

            // Certifique-se de que o DTO está sendo carregado corretamente
            if (_professional == null)
            {
                throw new Exception("Profissional não encontrado.");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erro ao buscar detalhes do profissional: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }
}

@if (_isLoading)
{
    <p>Carregando...</p>
}
else if (_professional == null)
{
    <p>Profissional não encontrado.</p>
}
else
{
    <div class="professional-details">
        <h2>Detalhes do Profissional: @(_professional.UserName ?? "Nome não disponível")</h2>
        <p><strong>Email:</strong> @(_professional.Email ?? "Email não disponível")</p>
        <p><strong>Telefone:</strong> @(_professional.PhoneNumber ?? "Telefone não disponível")</p>
        <p><strong>Tipos de Profissional:</strong> @string.Join(", ", _professional.ProfessionalTypes)</p>

        @if (_professional.ProfessionalTypes.Contains("Arquiteto") && _professional.GeneralArchitect != null)
        {
            <div class="architect-details">
                <h3>Informações de Arquiteto</h3>
                <p><strong>Nome:</strong> @(_professional.GeneralArchitect.name ?? "Nome não disponível")</p>
                <p><strong>Email:</strong> @(_professional.GeneralArchitect.email ?? "Email não disponível")</p>
                <p><strong>Registro no Conselho:</strong> @(_professional.GeneralArchitect.RegistroConselho ?? "Registro não disponível")</p>
                <p><strong>Especialidade:</strong> @(_professional.GeneralArchitect.Especialidade ?? "Especialidade não disponível")</p>
            </div>
        }

    </div>
}

<style>
    .professional-details {
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
        max-width: 600px;
        margin: 20px auto;
    }

    .architect-details {
        margin-top: 20px;
        padding: 15px;
        background-color: #e9ecef;
        border-radius: 8px;
    }

    h2, h3 {
        color: #343a40;
    }

    p {
        margin: 5px 0;
    }
</style>
